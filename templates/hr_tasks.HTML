<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù‡Ø§Ù… Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ / HR Tasks</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background:#f5f5f5; padding:20px; }
        .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .header h2 { color:#2c3e50; }
        .back-button { padding:8px 16px; border:none; border-radius:6px; background:#3498db; color:white; cursor:pointer; }
        .back-button:hover { background:#2980b9; }
        form.add-task { background:#fff; padding:15px; margin-bottom:20px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); display:flex; gap:10px; flex-wrap:wrap; }
        form.add-task input, form.add-task textarea, form.add-task button { padding:8px; border:1px solid #ccc; border-radius:4px; }
        form.add-task textarea { width:200px; height:40px; }
        form.add-task button { background:#27ae60; color:white; cursor:pointer; }
        form.add-task button:hover { background:#1e8449; }
        table.dataTable th, table.dataTable td { white-space:nowrap; }
        input[type='number'] { width:70px; }
    </style>
</head>
<body>
    <div class="header">
        <h2>ğŸ“‹ Ù…Ù‡Ø§Ù… Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ / HR Tasks</h2>
        <button onclick="window.location.href='/dashboard'" class="back-button">ğŸ”™ Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… / Back to Dashboard</button>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ù…Ø¨Ø§Ø´Ø±Ø© -->
    {% if session['role'] in ['Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©','Ù…Ø´Ø±Ù Ø¹Ø§Ù…'] %}
    <form class="add-task" method="POST" action="/add_or_update_task">
        <input type="hidden" name="action" value="add">
        <input type="text" name="task_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© / Task Name" required>
        <textarea name="task_details" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© / Task Details"></textarea>
        <input type="date" name="due_date" required>
        <button type="submit">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© / Add Task</button>
    </form>
    {% endif %}

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… -->
    <table id="tasksTable" class="display nowrap" style="width:100%">
        <thead>
            <tr>
                <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ù‡Ù…Ø©<br>Task ID</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©<br>Added Date</th>
                <th>Ø§Ù„Ù…Ù‡Ù…Ø©<br>Task Name</th>
                <th>ØªÙØ§ØµÙŠÙ„<br>Task Details</th>
                <th>Ø¨Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù†<br>Assigned By</th>
                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©<br>Status</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨<br>Due Date</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯<br>HR Action</th>
                <th>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø´Ø±Ù<br>Supervisor Evaluation</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.task_id }}</td>
                <td>{{ task.added_date }}</td>
                <td>{{ task.task_name }}</td>
                <td>{{ task.task_details }}</td>
                <td>{{ task.assigned_by }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.due_date }}</td>
                <td>
                   {% if session['role'] == 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©' %}
                   <form action="/add_or_update_task" method="POST" style="display:inline;">
                       <input type="hidden" name="action" value="complete">
                       <input type="hidden" name="task_id" value="{{ task.task_id }}">
                       <button type="submit" style="padding:4px 8px;background:#3b2ecc;color:white;border:none;border-radius:4px;cursor:pointer;">
                           âœ… Ù‡Ù„ ØªÙ…Øª Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ
                       </button>
                   </form>
                   {% else %}
                       {{ task.status }}
                   {% endif %}
                </td>

                <td>
                    {% if session['role'] == 'Ù…Ø´Ø±Ù Ø¹Ø§Ù…' %}
                    <form action="/add_or_update_task" method="POST" style="display:flex;gap:5px;">
                        <input type="hidden" name="action" value="evaluate">
                        <input type="hidden" name="task_id" value="{{ task.task_id }}">
                        <input type="number" name="evaluation" min="1" max="10" value="{{ task.supervisor_evaluation or '' }}" required>
                        <button type="submit">Ø­ÙØ¸</button>
                    </form>
                    <form action="/add_or_update_task" method="POST" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ');">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="task_id" value="{{ task.task_id }}">
                        <button type="submit" style="background:#e74c3c;color:white;border:none;padding:3px 8px;border-radius:4px;cursor:pointer;">Ø­Ø°Ù</button>
                    </form>
                    {% else %}
                        {{ task.supervisor_evaluation }}
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            var table = $('#tasksTable').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: [
                    { extend: 'excelHtml5', text: 'ğŸ’¾ ØªØµØ¯ÙŠØ± Excel' },
                    { extend: 'pdfHtml5', text: 'ğŸ–¨ï¸ ØªØµØ¯ÙŠØ± PDF' },
                    { extend: 'print', text: 'ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©' }
                ],
                language: {
                    search: "ğŸ” Ø¨Ø­Ø«:",
                    lengthMenu: "Ø¹Ø±Ø¶ _MENU_ Ù…Ù‡Ø§Ù…",
                    info: "Ø¹Ø±Ø¶ _START_ Ø¥Ù„Ù‰ _END_ Ù…Ù† Ø£ØµÙ„ _TOTAL_ Ù…Ù‡Ù…Ø©",
                    paginate: { first: "Ø§Ù„Ø£ÙˆÙ„Ù‰", last: "Ø§Ù„Ø£Ø®ÙŠØ±Ø©", next: "Ø§Ù„ØªØ§Ù„ÙŠ", previous: "Ø§Ù„Ø³Ø§Ø¨Ù‚" },
                    zeroRecords: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø·Ø§Ø¨Ù‚Ø©",
                    infoEmpty: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª",
                    infoFiltered: "(ØªÙ…Øª Ø§Ù„ØªØµÙÙŠØ© Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ _MAX_ Ù…Ù‡Ù…Ø©)"
                }
            });

            // âœ… ØªÙ„ÙˆÙŠÙ† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© "ØªÙ…Øª"
            $('#tasksTable').on('draw.dt', function () {
                $('#tasksTable tbody tr').each(function () {
                    var statusCell = $(this).find('td:eq(5)'); // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø³Ø§Ø¯Ø³: status
                    if (statusCell.text().trim() === "ØªÙ…Øª") {
                        statusCell.css({
                            'background-color': '#d4edda',
                            'color': '#155724',
                            'font-weight': 'bold'
                        });
                    }
                });
            }).trigger('draw.dt');
        });
    </script>
</body>
</html>

