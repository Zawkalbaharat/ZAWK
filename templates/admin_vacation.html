
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุทูุจุงุช ุงูุฅุฌุงุฒุฉ - ุงููุดุฑู ุงูุนุงู</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #fff; padding: 20px; }
        h2 { color: #2e7d32; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background-color: white; margin-bottom: 20px; }
        th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
        .status { font-weight: bold; padding: 6px 12px; border-radius: 6px; display: inline-block; }
        .status-approved-final { background-color: #006400; color: white; }
        .status-approved { background-color: #2196F3; color: white; }
        .status-pending { background-color: #FFEB3B; color: black; }
        .status-rejected { background-color: #f44336; color: white; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; color: white; cursor: pointer; margin-right: 5px; }
        .approve { background-color: #2e7d32; }
        .reject { background-color: #c62828; }
        .export { background-color: #2196F3; }
        .print { background-color: #FF9800; }
        .back { background-color: #777; margin-bottom: 20px; }
    </style>
</head>
<body>
    <a href="/leave_priority" style="position: absolute; top: 20px; left: 20px;">
    <button class="btn export" style="font-size: 16px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 8px;">
        ๐ ุฃููููุฉ ุงูุฅุฌุงุฒุงุช / Leave Priority
    </button>
</a>

    <a href="/dashboard"><button class="btn back">๐ ุงูุนูุฏุฉ ูููุญุฉ ุงููุดุฑู</button></a>
    <h2>ุฌููุน ุทูุจุงุช ุงูุฅุฌุงุฒุฉ / All Vacation Requests</h2>
    <table id="vacationRequestsTable">
        <thead>
            <tr>
                <th>ุฑูู ุงูุทูุจ</th>
                <th>ุงุณู ุงูููุธู</th>
                <th>ุฑูู ุงููููุฉ</th>
                <th>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</th>
                <th>ุชุงุฑูุฎ ุงูููุงูุฉ</th>
                <th>ุชูุงุตูู</th>
                <th>ุชุงุฑูุฎ ุงูุทูุจ</th>
                <th>ุชุงุฑูุฎ ุงูููุงููุฉ ุงูุฃููู</th>
                <th>ุชุงุฑูุฎ ุงูููุงููุฉ ุงูุซุงููุฉ</th>
                <th>ุงูุญุงูุฉ</th>
                <th>ุชุงุฑูุฎ ูุจุงุดุฑุฉ ุงูุนูู</th>
                <th>ุญุงูุฉ ุงููุจุงุดุฑุฉ</th>
                <th>ุชู ุฅุดุนุงุฑ ุงูููุงุฑุฏ</th>
                <th>ุฅุฌุฑุงุก</th>
                <th>ุฅุดุนุงุฑ ุงูููุงุฑุฏ</th>
            </tr>
        </thead>
        <tbody>
            {% for req in requests %}
            <tr>
                <td>{{ req['ุฑูู ุงูุทูุจ'] }}</td>
                <td>{{ req['ุงุณู ุงูููุธู'] }}</td>
                <td>{{ req['ุฑูู ุงููููุฉ'] }}</td>
                <td>{{ req['ุชุงุฑูุฎ ุงูุจุฏุงูุฉ'] }}</td>
                <td>{{ req['ุชุงุฑูุฎ ุงูููุงูุฉ'] }}</td>
                <td>{{ req['ุชูุงุตูู'] }}</td>
                <td>{{ req['ุชุงุฑูุฎ ุงูุทูุจ'] }}</td>
                <td>{{ req['ุชุงุฑูุฎ ุงูููุงููุฉ ุงูุฃููู'] }}</td>
                <td>{{ req['ุชุงุฑูุฎ ุงูููุงููุฉ ุงูุซุงููุฉ'] }}</td>
                <td>
                    <span class="status 
                        {% if req['ุงูุญุงูุฉ'] == 'ููุจูู ููุงุฆููุง' %}status-approved-final
                        {% elif req['ุงูุญุงูุฉ'] == 'ููุจูู' %}status-approved
                        {% elif req['ุงูุญุงูุฉ'] == 'ูุนูู' %}status-pending
                        {% elif 'ูุฑููุถ' in req['ุงูุญุงูุฉ'] %}status-rejected
                        {% endif %}">
                        {{ req['ุงูุญุงูุฉ'] }}
                    </span>
                </td>
                <td>{{ req['ุชุงุฑูุฎ ูุจุงุดุฑุฉ ุงูุนูู'] or '-' }}</td>
                <td>{{ req['ุญุงูุฉ ุงููุจุงุดุฑุฉ'] or 'ูุนููุฉ' }}</td>
                <td>{{ req['ุชู ุฅุดุนุงุฑ ุงูููุงุฑุฏ ุจุงููุจุงุดุฑุฉ'] or '-' }}</td>
                <td>
                    {% if req['ุชุงุฑูุฎ ูุจุงุดุฑุฉ ุงูุนูู'] == '' %}
                    <form method="POST" action="/admin_confirm_return">
                        <input type="hidden" name="request_id" value="{{ req['ุฑูู ุงูุทูุจ'] }}">
                        <input type="date" name="return_date" required>
                        <button type="submit" name="action" value="returned" class="btn approve">โ ูุจุงุดุฑุฉ</button>
                        <button type="submit" name="action" value="not_returned" class="btn reject" onclick="return confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃู ุงูููุธู ูู ูุนุฏุ')">โ ูู ูุนุฏ</button>
                    </form>
                    {% else %}-{% endif %}
                </td>
                <td>
                    {% if req['ุชุงุฑูุฎ ูุจุงุดุฑุฉ ุงูุนูู'] and (req['ุชู ุฅุดุนุงุฑ ุงูููุงุฑุฏ ุจุงููุจุงุดุฑุฉ'] == '' or req['ุชู ุฅุดุนุงุฑ ุงูููุงุฑุฏ ุจุงููุจุงุดุฑุฉ'] == '-' or not req['ุชู ุฅุดุนุงุฑ ุงูููุงุฑุฏ ุจุงููุจุงุดุฑุฉ']) %}
                    <form method="POST" action="/admin_notify_hr">
                        <input type="hidden" name="request_id" value="{{ req['ุฑูู ุงูุทูุจ'] }}">
                        <button type="submit" class="btn export">๐ข ุชู ุฅุดุนุงุฑ ุงูููุงุฑุฏ</button>
                    </form>
                    {% else %}-{% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button class="btn export" onclick="exportTableToExcel('vacationRequestsTable', 'Vacation_Requests')">๐ ุชุตุฏูุฑ Excel</button>
    <button class="btn print" onclick="window.print()">๐จ ุทุจุงุนุฉ</button>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        $('#vacationRequestsTable').DataTable({
            "order": [[0, "desc"]],
            "pageLength": 50,
            "language": {
                "search": "๐ ุจุญุซ:",
                "lengthMenu": "ุนุฑุถ _MENU_ ุทูุจ ููู ุตูุญุฉ",
                "info": "ุนุฑุถ _START_ ุฅูู _END_ ูู ุฃุตู _TOTAL_ ุทูุจ",
                "paginate": {
                    "first": "ุงูุฃูู",
                    "last": "ุงูุฃุฎูุฑ",
                    "next": "ุงูุชุงูู",
                    "previous": "ุงูุณุงุจู"
                },
                "zeroRecords": "ูุง ุชูุฌุฏ ูุชุงุฆุฌ",
                "infoEmpty": "ูุง ููุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง"
            }
        });
    });

    function exportTableToExcel(tableID, filename = '') {
        var dataType = 'application/vnd.ms-excel';
        var table = document.getElementById(tableID);
        var tableHTML = table.outerHTML.replace(/ /g, '%20');
        filename = filename ? filename + '.xls' : 'data.xls';
        var downloadLink = document.createElement("a");
        document.body.appendChild(downloadLink);
        if (navigator.msSaveOrOpenBlob) {
            var blob = new Blob(['๏ปฟ', tableHTML], { type: dataType });
            navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
            downloadLink.download = filename;
            downloadLink.click();
        }
    }
</script>
</body>
</html>
