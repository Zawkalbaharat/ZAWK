<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>๐ ุณุฌู ุญุถูุฑ ุงูููุธููู</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; direction: rtl; margin: 30px; background-color: #f9f9f9; }
        h2 { color: #2e7d32; text-align: center; }
        .upload-box { margin-bottom: 20px; text-align: center; }
        table { width: 100%; }
        .flash { color: red; text-align: center; margin: 10px; }
    </style>
</head>
<body>

   <div class="header">
  <button onclick="window.location.href='/dashboard'" class="back-button">
    ๐ ุฑุฌูุน ุฅูู ููุญุฉ ุงูุชุญูู / Back to Dashboard
  </button>
</div>
<style>
.back-button {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    background: #3498db;
    color: white;
    cursor: pointer;
    font-weight: bold;
}
.back-button:hover {
    background: #2980b9;
}
</style>


<div class="upload-box">
    <form method="POST" action="/upload_attendance" enctype="multipart/form-data">
        <label>๐ค ุฑูุน ููู Excel:</label>
        <input type="file" name="file" required>
        <button type="submit">ุฑูุน</button>
    </form>
    <br>
    <a href="/download_bulk_template" class="btn-template" download>๐ฅ ุชุญููู ูููุฐุฌ Excel ูุชุนุจุฆุฉ ุงูุญุถูุฑ ุงูุฌูุงุนู</a>
</div>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash">{{ messages[0] }}</div>
        {% endif %}
    {% endwith %}

<form method="get" action="/attendance" style="margin-bottom: 20px;">
  <label>๐ ุงูุดูุฑ:</label>
  <select name="month" onchange="this.form.submit()">
    <option value="">-- ูู ุงูุดููุฑ --</option>
    {% for month in all_months %}
    <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>{{ month }}</option>
    {% endfor %}
  </select>

  <label style="margin-right: 20px;">๐ข ุงููุฑุน:</label>
  <select name="branch" onchange="this.form.submit()">
    <option value="">-- ูู ุงููุฑูุน --</option>
    {% for branch in all_branches %}
    <option value="{{ branch }}" {% if branch == selected_branch %}selected{% endif %}>{{ branch }}</option>
    {% endfor %}
  </select>
</form>

    <table id="attendanceTable" class="display">
        <thead>
            <tr>
                <th>ุฑูู ุงููููุฉ</th>
                <th>ุฒูู ุงูุญุถูุฑ</th>
                <th>ุฒูู ุงูุงูุตุฑุงู</th>
                <th>ุณุงุนุงุช ุฏูุงู ูุชุฑุฉ ุงูุนูู</th>
                <th>ุณุงุนุงุช ุนูู ุงูููุธู</th>
                <th>ุบูุงุจ</th>
                <th>ุชุฃุฎูุฑ</th>
                <th>ุฅุฌูุงูู ุงุณุชูุทุงุน</th>
                <th>ููุงุญุธุงุช</th>
                <th>ุงูุดูุฑ</th>
                <th>ุงููุฑุน</th>
                <th>ุญุฐู</th>
            </tr>
        </thead>
        <tbody>
            {% for row in table %}
            <tr>
                <td>{{ row["ุฑูู ุงููููุฉ"] }}</td>
                <td>{{ row["ุฒูู ุงูุญุถูุฑ"] }}</td>
                <td>{{ row["ุฒูู ุงูุงูุตุฑุงู"] }}</td>
                <td>{{ row["ุณุงุนุงุช ุฏูุงู ูุชุฑุฉ ุงูุนูู"] }}</td>
                <td>{{ row["ุณุงุนุงุช ุนูู ุงูููุธู"] }}</td>
                <td>{{ row["ุบูุงุจ"] }}</td>
                <td>{{ row["ุชุฃุฎูุฑ"] }}</td>
                <td>{{ row["ุฅุฌูุงูู ุงุณุชูุทุงุน"] }}</td>
                <td>{{ row["ููุงุญุธุงุช"] }}</td>
                <td>{{ row["ุงูุดูุฑ"] }}</td>
                <td>{{ row["ุงููุฑุน"] }}</td>
                <td>
  <form method="POST" action="/delete_attendance" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุณุฌูุ');">
      <input type="hidden" name="ุฑูู ุงููููุฉ" value="{{ row['ุฑูู ุงููููุฉ'] }}">
      <input type="hidden" name="ุงูุดูุฑ" value="{{ row['ุงูุดูุฑ'] }}">
      <button type="submit" style="color:red;">๐๏ธ ุญุฐู</button>
  </form>
</td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    <hr>
   <h3>๐ ุฅุญุตุงุฆูุงุช ุงููุฑูุน (ุญุณุจ ุงูุดูุฑ ุงููุฎุชุงุฑ)</h3>
<table border="1" style="border-collapse: collapse; width: 100%; text-align: center;">
  <thead style="background-color: #f0f0f0;">
    <tr>
      <th>ุงููุฑุน</th>
      <th>ุนุฏุฏ ุงูููุธููู</th>
      <th>ูุฌููุน ุงูุบูุงุจ</th>
      <th>ุณุงุนุงุช ุงูุชุฃุฎูุฑ</th>
      <th>ุฅุฌูุงูู ุงูุงุณุชูุทุงุน</th>
      <th>ูุนุฏู ุณุงุนุงุช ุงูุนูู</th>
    </tr>
  </thead>
  <tbody>
    {% for stat in grouped_stats %}
    <tr>
      <td>{{ stat["ุงููุฑุน"] }}</td>
      <td>{{ stat["ุนุฏุฏ ุงูููุธููู"] }}</td>
      <td>{{ stat["ูุฌููุน ุงูุบูุงุจ"] }}</td>
      <td>{{ stat["ุณุงุนุงุช ุงูุชุฃุฎูุฑ"] }}</td>
      <td>{{ stat["ุฅุฌูุงูู ุงูุงุณุชูุทุงุน"] }}</td>
      <td>{{ stat["ูุนุฏู ุณุงุนุงุช ุงูุนูู"] }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>




    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#attendanceTable').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json"
                }
            });
        });
    </script>

</body>
</html>
