<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>ุฅุฏุงุฑุฉ ุงูููุธููู / Manage Employees</title>
<!-- DataTables CSS -->
<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet"/>
<link href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" rel="stylesheet"/>
<style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 30px; direction: rtl; }
        table { width: 100%; }
        .btn { padding: 5px 10px; margin: 2px; border: none; cursor: pointer; }
        .btn-danger { background-color: #d9534f; color: white; }
        .btn-success { background-color: #5cb85c; color: white; }
        .btn-info { background-color: #5bc0de; color: white; }
        h2 { margin-bottom: 20px; }
        .branch-box {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #ffe6e6;
            margin-bottom: 20px;
            width: 48%;
            float: left;
        }
    </style>
</head>
<body>
<div style="position: fixed; top: 20px; left: 20px; z-index: 9999;">
<a href="{{ url_for('dashboard') }}" style="text-decoration: none;">
<button class="btn btn-outline-primary btn-sm d-flex align-items-center shadow-sm" style="border-radius: 30px; padding: 6px 12px; font-size: 13px;">
      โฌ๏ธ ุฑุฌูุน / Back
    </button>
</a>
</div>
<h2>๐ฅ ุฅุฏุงุฑุฉ ุงูููุธููู / Manage Employees</h2>

{% if session['role'] == 'ูุดุฑู ุนุงู' %}
<div class="branch-box">
<h5>๐๏ธ ุชุนุฏูู ูุงุฆูุฉ ุงููุฑูุน / Branch List Editor</h5>
<form action="/update_branches" method="POST" onsubmit="return confirm('โ๏ธ ุชุนุฏูู ุงููุฑูุน ูุคุซุฑ ุนูู ุฌููุน ุงูุจูุงูุงุชุ ูู ุฃูุช ูุชุฃูุฏุ')">
<label>ุฃุณูุงุก ุงููุฑูุน (ุงูุตู ุจูููุง ุจูุงุตูุฉ):</label><br/>
<textarea name="branches" rows="2" style="width: 100%;">{{ current_branches }}</textarea><br/>
<button class="btn btn-danger mt-2" type="submit">๐พ ุญูุธ ุงููุฑูุน</button>
</form>
</div>
{% endif %}

{% if session['role'] != 'ูุฏูุฑ' %}
<!-- ุฒุฑ ุฅุถุงูุฉ -->
<button class="btn btn-success" onclick="document.getElementById('addModal').style.display='block'">โ ุฅุถุงูุฉ ููุธู / Add Employee</button>
<br/><br/>
{% endif %}

<table class="display" id="employeeTable">
<thead>
<tr>
<th>ุฑูู ุงููููุฉ</th>
<th>ุงูุงุณู</th>
<th>ุงูุจุฑูุฏ</th>
<th>ูููุฉ ุงููุฑูุฑ</th>
<th>ุงูุฏูุฑ</th>
<th>ุงููุฑุน</th>
<th>ุฑูู ุงููุงุชู</th>
<th>ุชุงุฑูุฎ ุขุฎุฑ ุฅุฌุงุฒุฉ</th>
<th>ูุฏุฉ ุงูุงุณุชุญูุงู (ุจุงูุฃูุงู)</th>
<th>ุนุฏุฏ ุงูุทูุจุงุช</th>
<th>ุขุฎุฑ ุชูููู (ูุฌููุน ุงููุณุจุฉ)</th>
<th>ุณุฌู ุงูุฅุถุงูุฉ/ุงูุญุฐู</th>
<th>ูููุฉ</th>
<th>ุณุฌู ุชุฌุงุฑู</th>
<th>ุฌูุณูุฉ</th>
<th>ุฌูุณ</th>
<th>ุชุงุฑูุฎ ูููุงุฏ</th>
<th>ุฑูุฒ ุงูููุงูุฉ</th>
<th>ุงูุงุฌุฑ</th>
<th>ุฑูู ุญุฏูุฏ</th>
<th>ุชุงุฑูุฎ ุงูุชุญุงู</th>
            {% if session['role'] != 'ูุฏูุฑ' %}
            <th>ุฅุฌุฑุงุก</th>
            {% endif %}
        </tr>
</thead>
<tbody>
        {% for emp in employees %}
        <tr>
<td>{{ emp['ุฑูู ุงููููุฉ'] }}</td>
<td>{{ emp['ุงูุงุณู'] }}</td>
<td>{{ emp['ุงูุจุฑูุฏ'] }}</td>
<td>{{ emp['ูููุฉ ุงููุฑูุฑ'] }}</td>
<td>{{ emp['ุงูุฏูุฑ'] }}</td>
<td>{{ emp['ุงููุฑุน'] }}</td>
<td>{{ emp['ุฑูู ุงููุงุชู'] }}</td>
<td>{{ emp['ุชุงุฑูุฎ ุขุฎุฑ ุฅุฌุงุฒุฉ'] }}</td>
<td>{{ emp['ูุฏุฉ ุงูุงุณุชุญูุงู (ุจุงูุฃูุงู)'] }}</td>
<td>{{ emp['ุนุฏุฏ ุงูุทูุจุงุช'] }}</td>
<td>{{ emp['ุขุฎุฑ ุชูููู (ูุฌููุน ุงููุณุจุฉ)'] }}</td>
<td>{{ emp['ุณุฌู ุงูุฅุถุงูุฉ/ุงูุญุฐู'] }}</td>
<td>{{ emp['ูููุฉ'] }}</td>
<td>{{ emp['ุณุฌู ุชุฌุงุฑู'] }}</td>
<td>{{ emp['ุฌูุณูุฉ'] }}</td>
<td>{{ emp['ุฌูุณ'] }}</td>
<td>{{ emp['ุชุงุฑูุฎ ูููุงุฏ'] }}</td>
<td>{{ emp['ุฑูุฒ ุงูููุงูุฉ'] }}</td>
<td>{{ emp['ุงูุงุฌุฑ'] }}</td>
<td>{{ emp['ุฑูู ุญุฏูุฏ'] }}</td>
<td>{{ emp['ุชุงุฑูุฎ ุงูุชุญุงู'] }}</td>
            {% if session['role'] != 'ูุฏูุฑ' %}
            <td>
<form action="/delete_employee" method="POST" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุงูุญุฐูุ')">
<input name="employee_id" type="hidden" value="{{ emp['ุฑูู ุงููููุฉ'] }}"/>
<button class="btn btn-danger">๐๏ธ ุญุฐู</button>
</form>
<button class="btn btn-info" onclick="openEditModal({{ loop.index0 }})">โ๏ธ ุชุนุฏูู</button></td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
<!-- ูููุฐุฌ ุฅุถุงูุฉ ููุธู -->
{% if session['role'] != 'ูุฏูุฑ' %}
<div id="addModal" style="display:none; position:fixed; top:10%; left:20%; background:#fff; padding:20px; border:1px solid #ccc;">
<h3>ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ</h3>
<form action="/add_employee" method="POST">
<label>ุฑูู ุงููููุฉ:</label><input name="employee_id" required=""/><br/>
<label>ุงูุงุณู:</label><input name="employee_name" placeholder="ูุซุงู: ูุญูุฏ ุฃุญูุฏ - Mohammed Ahmed" required=""/><br/>
<small style="color: red;">
          โ๏ธ ูุฑุฌู ูุชุงุจุฉ ุงูุงุณู ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ ููุตูููุง ุจู "-" ูุซู: ูุญูุฏ ุฃุญูุฏ - Mohammed Ahmed
        </small><br/>
<label>ุงูุจุฑูุฏ:</label><input name="email"/><br/>
<label>ูููุฉ ุงููุฑูุฑ:</label><input name="password"/><br/>
<label>ุงูุฏูุฑ:</label>
<select name="role">
<option>ููุธู</option>
<option>ูุฏูุฑ</option>
<option>ููุงุฑุฏ ุจุดุฑูุฉ</option>
<option>ูุดุฑู ุนุงู</option>
</select><br/>
<label>ุงููุฑุน:</label>
<select name="branch">
            {% for branch in branches %}
                <option value="{{ branch }}">{{ branch }}</option>
            {% endfor %}
        </select><br/>
<label>ุฑูู ุงููุงุชู:</label><input name="phone"/><br/>
<label>ุชุงุฑูุฎ ุขุฎุฑ ุฅุฌุงุฒุฉ:</label><input type="date" name="last_leave"><br>
<label>ูุฏุฉ ุงูุงุณุชุญูุงู (ุจุงูุฃูุงู):</label><input name="entitlement_days"/><br/>
<label>ูููุฉ:</label><input name="job_title"/><br/>
<label>ุณุฌู ุชุฌุงุฑู:</label><input name="commercial_record"/><br/>
<label>ุฌูุณูุฉ:</label><input name="nationality"/><br/>
<label>ุฌูุณ:</label><input name="gender"/><br/>
<label>ุชุงุฑูุฎ ูููุงุฏ:</label><input type="date" name="birth_date"><br>
<label>ุฑูุฒ ุงูููุงูุฉ:</label><input name="sponsor_code"/><br/>
<label>ุงูุฃุฌุฑ:</label><input name="salary"/><br/>
<label>ุฑูู ุญุฏูุฏ:</label><input name="border_number"/><br/>
<label>ุชุงุฑูุฎ ุงูุชุญุงู:</label><input type="date" name="joining_date"><br>
<br/>
<button class="btn btn-success" type="submit">๐พ ุญูุธ</button>
<button class="btn btn-info" onclick="document.getElementById('addModal').style.display='none'" type="button">ุฅูุบุงุก</button>
</form>
</div>
{% endif %}

<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
    $(document).ready(function () {
        $('#employeeTable').DataTable({
            dom: 'Blfrtip',
            buttons: ['excel', 'print'],
            language: {
                search: "๐ ุจุญุซ:",
                lengthMenu: "ุนุฑุถ _MENU_ ุตููู",
                info: "ุนุฑุถ _START_ ุฅูู _END_ ูู ุฃุตู _TOTAL_ ุตู",
                paginate: { next: "ุงูุชุงูู", previous: "ุงูุณุงุจู" },
                zeroRecords: "ูุง ุชูุฌุฏ ูุชุงุฆุฌ",
                infoEmpty: "ูุง ุชูุฌุฏ ุณุฌูุงุช",
                infoFiltered: "(ุชูุช ุงูุชุตููุฉ ูู ุฅุฌูุงูู _MAX_ ุตู)",
                buttons: {
                    print: "๐จ๏ธ ุทุจุงุนุฉ",
                    excel: "๐ฅ ุชุตุฏูุฑ Excel"
                }
            }
        });
    });
</script>
<!-- ูุงูุฐุฉ ุชุนุฏูู ุจูุงูุงุช ููุธู -->
<div id="editModal" style="display:none; position:fixed; top:10%; left:20%; background:#fff; padding:20px; border:1px solid #ccc; max-height:80vh; overflow:auto;">
<h3>โ๏ธ ุชุนุฏูู ุจูุงูุงุช ููุธู</h3>
<form action="/update_employee" method="POST">
<input id="edit_index" name="index" type="hidden"/>
<label>ุงูุงุณู:</label><input id="edit_name" name="employee_name"/><br/>
<label>ุงูุจุฑูุฏ:</label><input id="edit_email" name="email"/><br/>
<label>ูููุฉ ุงููุฑูุฑ:</label><input id="edit_password" name="password"/><br/>
<label>ุงูุฏูุฑ:</label>
<select id="edit_role" name="role">
<option>ููุธู</option>
<option>ูุฏูุฑ</option>
<option>ููุงุฑุฏ ุจุดุฑูุฉ</option>
<option>ูุดุฑู ุนุงู</option>
</select><br/>
<label>ุงููุฑุน:</label><input id="edit_branch" name="branch"/><br/>
<label>ุฑูู ุงููุงุชู:</label><input id="edit_phone" name="phone"/><br/>
<label>ุชุงุฑูุฎ ุขุฎุฑ ุฅุฌุงุฒุฉ:</label><input id="edit_last_leave" name="last_leave" type="date"/><br/>
<label>ูุฏุฉ ุงูุงุณุชุญูุงู (ุจุงูุฃูุงู):</label><input id="edit_entitlement" name="entitlement_days" type="number"/><br/>
<label>ูููุฉ:</label><input id="edit_job" name="job_title"/><br/>
<label>ุณุฌู ุชุฌุงุฑู:</label><input id="edit_cr" name="commercial_record"/><br/>
<label>ุฌูุณูุฉ:</label><input id="edit_nationality" name="nationality"/><br/>
<label>ุฌูุณ:</label><input id="edit_gender" name="gender"/><br/>
<label>ุชุงุฑูุฎ ูููุงุฏ:</label><input id="edit_birth" name="birth_date" type="date"/><br/>
<label>ุฑูุฒ ุงูููุงูุฉ:</label><input id="edit_sponsor" name="sponsor_code"/><br/>
<label>ุงูุฃุฌุฑ:</label><input id="edit_salary" name="salary" type="number"/><br/>
<label>ุฑูู ุญุฏูุฏ:</label><input id="edit_border" name="border_number"/><br/>
<label>ุชุงุฑูุฎ ุงูุชุญุงู:</label><input id="edit_join" name="joining_date" type="date"/><br/>
<br/>
<button class="btn btn-success" type="submit">๐พ ุญูุธ ุงูุชุนุฏููุงุช</button>
<button class="btn btn-danger" onclick="document.getElementById('editModal').style.display='none'" type="button">ุฅุบูุงู</button>
</form>
</div>
<script>
  const employees = {{ employees | tojson | safe }};
  function openEditModal(index) {
    const emp = employees[index];
    document.getElementById('edit_index').value = index;
    document.getElementById('edit_name').value = emp['ุงูุงุณู'];
    document.getElementById('edit_email').value = emp['ุงูุจุฑูุฏ'];
    document.getElementById('edit_password').value = emp['ูููุฉ ุงููุฑูุฑ'];
    document.getElementById('edit_role').value = emp['ุงูุฏูุฑ'];
    document.getElementById('edit_branch').value = emp['ุงููุฑุน'];
    document.getElementById('edit_phone').value = emp['ุฑูู ุงููุงุชู'];
    document.getElementById('edit_last_leave').value = emp['ุชุงุฑูุฎ ุขุฎุฑ ุฅุฌุงุฒุฉ'];
    document.getElementById('edit_entitlement').value = emp['ูุฏุฉ ุงูุงุณุชุญูุงู (ุจุงูุฃูุงู)'];
    document.getElementById('edit_job').value = emp['ูููุฉ'];
    document.getElementById('edit_cr').value = emp['ุณุฌู ุชุฌุงุฑู'];
    document.getElementById('edit_nationality').value = emp['ุฌูุณูุฉ'];
    document.getElementById('edit_gender').value = emp['ุฌูุณ'];
    document.getElementById('edit_birth').value = emp['ุชุงุฑูุฎ ูููุงุฏ'];
    document.getElementById('edit_sponsor').value = emp['ุฑูุฒ ุงูููุงูุฉ'];
    document.getElementById('edit_salary').value = emp['ุงูุงุฌุฑ'];
    document.getElementById('edit_border').value = emp['ุฑูู ุญุฏูุฏ'];
    document.getElementById('edit_join').value = emp['ุชุงุฑูุฎ ุงูุชุญุงู'];
    document.getElementById('editModal').style.display = 'block';
  }
</script>
</body>
</html>