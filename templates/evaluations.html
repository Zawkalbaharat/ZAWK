<!DOCTYPE html>
{% if user_role == 'Ù…Ø´Ø±Ù Ø¹Ø§Ù…' %}
<div class="card p-3 mb-3 border border-primary bg-light">
  <h5>ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø¹Ù„Ø§ÙˆØ© / Bonus Percentage Rules</h5>
  <form action="/update_bonus_rules" method="POST" class="row g-2">
    {% for key in ['100', '95-99', '90-94', '85-89', '80-84', '70-79'] %}
    <div class="col-md-2">
      <label class="form-label">{{ key }}%</label>
      <input type="number" name="{{ key }}" class="form-control form-control-sm" step="0.1" min="0" max="200" required value="{{ bonus_rules.get(key, '') }}">
    </div>
    {% endfor %}
    <div class="col-md-12 text-end mt-2">
      <button type="submit" class="btn btn-primary btn-sm">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­</button>
    </div>
  </form>
</div>
{% endif %}

<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† / Employee Evaluations</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <style>
        body {
            background-color: #f9f9f9;
        }
        h2 {
            margin-top: 20px;
            text-align: center;
        }
        .table-danger {
            background-color: #f8d7da !important;
        }
        .back-btn {
            position: fixed;
            left: 20px;
            top: 90px;
            z-index: 9999;
        }
    </style>
</head>
<body>

<!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
  <a href="{{ url_for('dashboard') }}" style="text-decoration: none;">
    <button class="btn btn-outline-primary btn-sm d-flex align-items-center shadow-sm"
            style="border-radius: 30px; padding: 6px 12px; font-size: 13px;">
      â¬…ï¸ Ø±Ø¬ÙˆØ¹ / Back
    </button>
  </a>
</div>
{% if user_role == 'Ù…ÙˆØ¸Ù' %}
<div class="container mt-4">
  <div class="card border-success">
    <div class="card-header bg-success text-white">
      ğŸ“Š ØªÙ‚ÙŠÙŠÙ…ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ / My Evaluation
    </div>
    <div class="card-body">
      {% if evaluations|length == 0 %}
        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ… Ù…Ø³Ø¬Ù„ Ù„Ùƒ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
      {% else %}
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-light">
              <tr>
                <th>Ø§Ù„ÙØªØ±Ø© / Period</th>
                <th>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ / Punctuality</th>
                <th>Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª / Discipline</th>
                <th>Ø§Ù„ØªØ¹Ø§Ù…Ù„ / Behavior</th>
                <th>Ø§Ù„Ø¨ØµÙ…Ø© / Attendance</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ / Total</th>
                <th>Ø§Ù„Ø¹Ù„Ø§ÙˆØ© / Bonus</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ… / Date</th>
              </tr>
            </thead>
            <tbody>
              {% for row in evaluations %}
              <tr class="{% if row.total_score and row.total_score|float < 60 %}table-danger{% endif %}">
                <td>{{ row.period }}</td>
                <td>{{ row.punctuality }}</td>
                <td>{{ row.discipline }}</td>
                <td>{{ row.behavior }}</td>
                <td>{{ row.attendance }}</td>
                <td>{{ row.total_score }}</td>
                <td>{{ row.bonus_percentage }}%</td>
                <td>{{ row.evaluation_date }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>
  </div>
</div>
<hr>
{% endif %}

<div class="container">
    <h2>ğŸ“ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† / Employee Evaluations</h2>

    <!-- Ø²Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
    <form action="/sync_evaluations" method="post" class="text-end mb-3">
        <button type="submit" class="btn btn-outline-primary btn-sm">
            ğŸ” Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª / Sync Evaluations
        </button>
    </form>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
    <div class="table-responsive">
        <table id="evaluationsTable" class="table table-bordered table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Ø§Ù„Ù‡ÙˆÙŠØ© / ID</th>
                    <th>Ø§Ù„Ø§Ø³Ù… / Name</th>
                    <th>Ø§Ù„ÙØ±Ø¹ / Branch</th>
                    <th>Ø§Ù„ÙˆØ¸ÙŠÙØ© / Role</th>
                    <th>Ø§Ù„ÙØªØ±Ø© / Period</th>
                    <th>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ / Punctuality (25)</th>
                    <th>Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª / Discipline (25)</th>
                    <th>Ø§Ù„ØªØ¹Ø§Ù…Ù„ / Behavior (25)</th>
                    <th>Ø§Ù„Ø¨ØµÙ…Ø© / Attendance (25)</th>
                    <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ / Total</th>
                    <th>Ø§Ù„Ø¹Ù„Ø§ÙˆØ© / Bonus</th>
                    <th>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù… / Evaluator</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ… / Date</th>
                    <th>ğŸ’¾</th>
                </tr>
            </thead>
            <tbody>
                {% for row in evaluations %}
                <tr class="{% if row.total_score and row.total_score|float < 60 %}table-danger{% endif %}">
                    <form method="POST" action="/save_evaluation">
                        <td><input type="hidden" name="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" value="{{ row['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©'] }}">{{ row['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©'] }}</td>
                        <td>{{ row['Ø§Ù„Ø§Ø³Ù…'] }}</td>
                        <td>{{ row['Ø§Ù„ÙØ±Ø¹'] }}</td>
                        <td>{{ row['Ø§Ù„Ø¯ÙˆØ±'] }}</td>
                        <td>{{ row.period }}<input type="hidden" name="period" value="{{ row.period }}"></td>

                        <td>
                            {% if user_role in ['Ù…Ø´Ø±Ù Ø¹Ø§Ù…', 'Ù…Ø¯ÙŠØ±', 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©'] %}
                                <input type="number" step="0.1" max="25" name="punctuality" class="form-control form-control-sm" value="{{ row.punctuality }}">
                            {% else %}
                                {{ row.punctuality }}
                            {% endif %}
                        </td>
                        <td>
                            {% if user_role in ['Ù…Ø´Ø±Ù Ø¹Ø§Ù…', 'Ù…Ø¯ÙŠØ±', 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©'] %}
                                <input type="number" step="0.1" max="25" name="discipline" class="form-control form-control-sm" value="{{ row.discipline }}">
                            {% else %}
                                {{ row.discipline }}
                            {% endif %}
                        </td>
                        <td>
                            {% if user_role in ['Ù…Ø´Ø±Ù Ø¹Ø§Ù…', 'Ù…Ø¯ÙŠØ±', 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©'] %}
                                <input type="number" step="0.1" max="25" name="behavior" class="form-control form-control-sm" value="{{ row.behavior }}">
                            {% else %}
                                {{ row.behavior }}
                            {% endif %}
                        </td>
                        <td>
                            {% if user_role in ['Ù…Ø´Ø±Ù Ø¹Ø§Ù…', 'Ù…Ø¯ÙŠØ±', 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©'] %}
                                <input type="number" step="0.1" max="25" name="attendance" class="form-control form-control-sm" value="{{ row.attendance }}">
                            {% else %}
                                {{ row.attendance }}
                            {% endif %}
                        </td>

                        <td>{{ row.total_score }}</td>
                        <td>{{ row.bonus_percentage }}</td>
                        <td>{{ row.evaluator }}</td>
                        <td>{{ row.evaluation_date }}</td>

                        <td>
                            {% if (user_role == 'Ù…Ø´Ø±Ù Ø¹Ø§Ù…') or
                                  (user_role == 'Ù…Ø¯ÙŠØ±' and row['Ø§Ù„ÙØ±Ø¹'] == user_branch) or
                                  (user_role == 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©') %}
                                <button type="submit" class="btn btn-success btn-sm">ğŸ’¾</button>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
    $(document).ready(function () {
        $('#evaluationsTable').DataTable({
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json"
            },
            "pageLength": 10
        });
    });
</script>

</body>
</html>
