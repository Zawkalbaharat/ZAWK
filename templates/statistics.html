
<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
        body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
        h2 { text-align: center; color: #2d4832; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #e0ebe4; }
        .chart { margin-top: 40px; }
        .export-buttons { margin-top: 20px; text-align: left; }
        button { padding: 10px 15px; margin-right: 10px; background: #2d4832; color: white; border: none; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body>
<h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Statistics Dashboard</h2>

<a href="/full_employee_info" class="btn btn-employee-info">ğŸ§¾ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„ÙƒØ§Ù…Ù„ / Full Employee Info</a>

<style>
.btn-employee-info {
    background-color: #3949ab;
    color: white;
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    display: inline-block;
    margin: 10px 0;
}
.btn-employee-info:hover {
    background-color: #1a237e;
}
</style>


<div class="export-buttons">
<button onclick="exportTableToCSV()">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
<button onclick="window.print()">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF</button>
</div>
<div style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
<select class="form-control" id="monthFilter" onchange="filterTable()">
<option value="">Ø§Ø®ØªØ± Ø´Ù‡Ø±Ù‹Ø§</option>
<option value="2025-06">2025-06</option>
<option value="2025-07">2025-07</option>
</select>
<select class="form-control" id="branchFilter" onchange="filterTable()">
<option value="">ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹</option>
<option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
<option value="Ø¬Ø¯Ø©">Ø¬Ø¯Ø©</option>
</select>
</div>
<table id="stats-table">
<thead>
<tr>
  <th>Ø§Ù„Ø´Ù‡Ø±</th>
  <th>Ø§Ù„ÙØ±Ø¹</th>
  <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</th>
  <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ¦Ø°Ø§Ù†Ø§Øª</th>
  <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</th>
  <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</th>
  <th>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø®ØµÙ… (Ø±ÙŠØ§Ù„)</th>
  <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª (Ø±ÙŠØ§Ù„)</th>
</tr>
</thead>
<tbody>
{% for row in stats %}
<tr>
  <td>{{ row['Ø§Ù„Ø´Ù‡Ø±'] }}</td>
  <td>{{ row['Ø§Ù„ÙØ±Ø¹'] }}</td>
  <td>{{ row['Ø¥Ø¬Ø§Ø²Ø©'] }}</td>
  <td>{{ row['Ø§Ø³ØªØ¦Ø°Ø§Ù†'] }}</td>
  <td>{{ row['Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©'] }}</td>
  <td>{{ row['Ø®ØµÙ…'] }}</td>
  <td>{{ row['Ù…ØªÙˆØ³Ø· Ø§Ù„Ø®ØµÙ… (Ø±ÙŠØ§Ù„)'] }}</td>
  <td>{{ row['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª (Ø±ÙŠØ§Ù„)'] }}</td>
</tr>
{% endfor %}
</tbody>

</table>
<div class="chart" id="bar-chart"></div>
<script>
    var data = [
        {"branch": "Ø§Ù„Ø±ÙŠØ§Ø¶", "month": "2025-06", "leaves": 2, "permissions": 3, "extra_hours": 12, "deductions": 2},
        {"branch": "Ø¬Ø¯Ø©", "month": "2025-06", "leaves": 1, "permissions": 1, "extra_hours": 6, "deductions": 1},
        {"branch": "Ø§Ù„Ø±ÙŠØ§Ø¶", "month": "2025-07", "leaves": 4, "permissions": 2, "extra_hours": 10, "deductions": 3}
    ];

    const traceLeaves = {
        x: data.map(r => r.branch + " - " + r.month),
        y: data.map(r => r.leaves),
        name: 'Ø¥Ø¬Ø§Ø²Ø§Øª',
        type: 'bar'
    };

    const tracePerms = {
        x: data.map(r => r.branch + " - " + r.month),
        y: data.map(r => r.permissions),
        name: 'Ø§Ø³ØªØ¦Ø°Ø§Ù†Ø§Øª',
        type: 'bar'
    };

    const traceHours = {
        x: data.map(r => r.branch + " - " + r.month),
        y: data.map(r => r.extra_hours),
        name: 'Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©',
        type: 'bar'
    };

    const traceDeductions = {
        x: data.map(r => r.branch + " - " + r.month),
        y: data.map(r => r.deductions),
        name: 'Ø®ØµÙˆÙ…Ø§Øª',
        type: 'bar'
    };

    const layout = {
        barmode: 'group',
        title: 'Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙØ±ÙˆØ¹ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨',
        xaxis: { title: 'Ø§Ù„ÙØ±Ø¹ - Ø§Ù„Ø´Ù‡Ø±' },
        yaxis: { title: 'Ø§Ù„Ø¹Ø¯Ø¯ / Ø§Ù„Ø³Ø§Ø¹Ø§Øª' }
    };

    Plotly.newPlot('bar-chart', [traceLeaves, tracePerms, traceHours, traceDeductions], layout);

    function exportTableToCSV() {
        const table = document.getElementById("stats-table");
        let csv = "";
        for (let row of table.rows) {
            let cells = [...row.cells].map(cell => `"${cell.innerText}"`);
            csv += cells.join(",") + "\n";
        }
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "statistics.csv";
        a.click();
    }

    function filterTable() {
        var month = document.getElementById('monthFilter').value;
        var branch = document.getElementById('branchFilter').value;
        var table = document.getElementById("stats-table");
        var rows = table.querySelectorAll("tbody tr");

        rows.forEach(function(row) {
            var rowMonth = row.cells[0].innerText;
            var rowBranch = row.cells[1].innerText;
            var show = true;
            if (month && rowMonth !== month) show = false;
            if (branch && rowBranch !== branch) show = false;
            row.style.display = show ? "" : "none";
        });
    }
</script>

<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ù„ÙƒÙ„ ÙØ±Ø¹</h3>
<table border="1">
<thead>
<tr>
<th>Ø§Ù„ÙØ±Ø¹</th>
<th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª (Ø±ÙŠØ§Ù„)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ø§Ù„Ø±ÙŠØ§Ø¶</td>
<td>500.0</td>
</tr>
</tbody>
</table>
</body>
</html>
